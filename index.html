<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>GeoJSONLayer | Sample | ArcGIS API for JavaScript 4.16</title>

  <style>
    html,
    body,
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
  </style>

  <link rel="stylesheet" href="https://js.arcgis.com/4.16/esri/themes/light/main.css" />
  <script src="https://js.arcgis.com/4.16/"></script>

  <script>
    require([
      "esri/Map",
      "esri/views/SceneView",
      "esri/layers/GeoJSONLayer",
      "esri/layers/SceneLayer"
    ], function (Map, SceneView, GeoJSONLayer, SceneLayer) {

      let returnValue = []
      let floor = 10

      // for (let i = 0; i < floor; i++) {
      //   let temp =
      //   {
      //     "type": "Feature",
      //     "properties": {
      //       "@id": "way/floor" + i == 0 ? 'G' : i,
      //       "addr:city": "Ho Chi Minh City",
      //       "addr:district": "Thủ Đức",
      //       "addr:street": "Tân Trào",
      //       "addr:subdistrict": "Phường Dĩ an",
      //       "building": "B - Floor" + ' ' + (i == 0 ? 'G' : i),
      //       "building:levels": floor,
      //       "height": 110,
      //       "name": `Block B - Floor ${i == 0 ? 'G' : i}`,
      //       "name:vi": `Tòa B -106.8040241960683 ${i == 0 ? 'G' : i}`,
      //       "office": "B - Floor" + ' ' + (i == 0 ? 'G' : i),
      //       "website": "https://www.uit.edu.vn"
      //     },
      //     "geometry": {
      //       "type": "Polygon",
      //       "coordinates": [
      //         [
      //           [106.80343417785849, 10.869974955949484], // 1
      //           [106.80353945455835, 10.87013761058512], // 2
      //           [106.8035454895284, 10.870131025378926], //3
      //           // block1

      //           [106.80370172819748, 10.870213998966669], // 4
      //           [106.80370306930193, 10.870204779680313], // 5
      //           //block2

      //           [106.80387795655744, 10.870212397196315], //6
      //           [106.80387393324406, 10.870199885307557], // 7
      //           //block3

      //           [106.80403553633396, 10.87013271621164], //8
      //           //block4

      //           [106.80412404922808, 10.870037230705965], //9
      //           [106.80414416579494, 10.86999771945331], //10
      //           [106.80413276640706, 10.869989158681213], // 11
      //           //block5

      //           [106.80416361181175, 10.869917379889435], //12
      //           [106.80417635230408, 10.869833747698191], //13
      //           [106.80402614860495, 10.869833747698191], //14
      //           [106.80402212529157, 10.869877210099714], //15
      //           [106.80406973449979, 10.869887746438522], //16
      //           //block6

      //           [106.80404425351291, 10.869947671859078], // 17
      //           [106.80403486578173, 10.869970720094305], // 18
      //           [106.80399798540917, 10.869948988901161], //19
      //           //block 5

      //           [106.80393830626085, 10.870007597266962], //20
      //           [106.80392020135069, 10.870023401768139], // 21
      //           [106.8039369651564, 10.870058961892708], // 22
      //           [106.80390075533606, 10.870074766391149], //23
      //           //block4

      //           [106.80386320440842, 10.870083985681424], //24
      //           [106.80385046391606, 10.870054352247061], //25
      //           //block3

      //           [106.8037513490589, 10.870044100643698], //26
      //           [106.80372922083535, 10.870043442122867], //27
      //           [106.80371178647768, 10.870077685203622], // 28
      //           //block2

      //           [106.8036467429148, 10.870028296143643], //29
      //           [106.80367356500393, 10.87000524791287], //30
      //           [106.80361992082567, 10.869919640182983], //31
      //           [106.80343417785849, 10.869974955949484] //32
      //           // block1

      //         ]
      //       ]
      //     }
      //   }

      //   //temp["geometry"]["coordinates"][0]
      //   tranformItem(temp["geometry"]["coordinates"][0], i)

      //   temp["geometry"]["coordinates"][0].forEach((item, index) => {
      //     item.push(i * 10 + 27)
      //     if (index == temp["geometry"]["coordinates"][0].length - 1) {
      //       console.log(`Tầng ${i == 0 ? 'G' : i}`)
      //       returnValue.push(temp)

      //       if (i == floor - 1)
      //         console.log(JSON.stringify(returnValue))
      //     }
      //   })
      // }

      function tranformItem(item, index) {
        switch (index) {
          case 5: item.splice(11, 5); break;
          case 6: item.splice(8, 11); break;
          case 7: item.splice(7, 16); break;
          case 8: item.splice(5, 20); break;
          case 9: item.splice(2, 26); break;
          default: item; break;
        }
      }

      // const geojsonLayer = new GeoJSONLayer({
      //   url: "geojson/q7.geojson",
      // }), geojsonLayer2 = new GeoJSONLayer({
      //   url: "geojson/sample.geojson",
      // }), geojsonMyHouse = new GeoJSONLayer({
      //   url: "geojson/myhouse.geojson"
      // })
      const geojsonFloor = new GeoJSONLayer({
        url: "geojson/dataFloor.geojson",
      })

      const geojsonWindow = new GeoJSONLayer({
        url: "geojson/dataWindow.geojson",
      })


      geojsonWindow.renderer = {
        type: "simple",
        symbol: {
          type: "line-3d",

          symbolLayers: [
            {
              type: "path",
              width: 0.1,
              material: {
                color: '#000000'
              }
            }
          ]
        }
      }

      geojsonFloor.renderer = {
        type: "simple",
        symbol: {
          type: "polygon-3d",
          symbolLayers: [
            {
              type: "extrude",
              material: {
                color: '#97cee6'
              },
              edges: {
                type: "solid", // autocasts as new SolidEdges3D()
                color: [50, 50, 50, 0.5]
              }
            }
          ],
        },
        visualVariables: [
          {
            type: "size",
            field: "size",
            stops: [
              {
                value: 0.5,
                size: 0.5
              }, {
                value: 1,
                size: 1
              }
            ]
          }
        ]
      }
      //   visualVariables: [
      //     {
      //       type: "color",
      //       field: 'building:levels',
      //       stops: [
      //         {
      //           value: 4,
      //           color: '#ffa31a',
      //           label: '12m'
      //         },
      //         {
      //           value: 5,
      //           color: '#ffb84d',
      //           label: '15m'
      //         },
      //         {
      //           value: 6,
      //           color: '#ffcc80',
      //           label: '18m'
      //         },
      //         {
      //           value: 15,
      //           color: '#ffe0b3',
      //           label: '45m'
      //         },
      //         {
      //           value: 22,
      //           color: '#fff5e6',
      //           label: '66m'
      //         }
      //       ]
      //     }
      //   ]
      // };
      // geojsonLayer2.renderer = {
      //   type: "simple",
      //   symbol: {
      //     type: "polygon-3d",
      //     symbolLayers: [
      //       {
      //         type: "extrude",
      //         size: 15
      //       },
      //     ]
      //   },
      //   visualVariables: [
      //     {
      //       type: "color",
      //       field: "building:levels",
      //       stops: [
      //         {
      //           value: 4,
      //           color: "#ffe699"
      //         },
      //         {
      //           value: 22,
      //           color: "#ffb3e6",
      //         }
      //       ]
      //     }
      //   ]
      // };

      // geojsonMyHouse.renderer = {
      //   type: "simple",
      //   symbol: {
      //     type: "polygon-3d",
      //     symbolLayers: [
      //       {
      //         type: "extrude",
      //       }
      //     ]
      //   },
      //   visualVariables: [
      //     {
      //       type: "color",
      //       field: 'height',
      //       stops: [
      //         {
      //           value: 4,
      //           color: "#ff6666"
      //         },
      //         {
      //           value: 12,
      //           color: "#97cee6",
      //         }
      //       ]
      //     },
      //     {
      //       type: "size",
      //       field: 'height',
      //       stops: [
      //         {
      //           value: 4,
      //           size: 0
      //         },
      //         {
      //           value: 12,
      //           size: 15,
      //         }
      //       ]
      //     }
      //   ]
      // }
      const map = new Map({
        basemap: "topo-vector",
        ground: "world-elevation",
        layers: [geojsonFloor] //end layers
      });

      const view = new SceneView({
        container: "viewDiv",
        map: map,
        camera: {
          position: [106.80381562113178, 10.863640178283095, 400],
          heading: 0,
          tilt: 55
        }
      });

      view.on('click', (event) => {
        console.log(`${event.mapPoint.longitude}, ${event.mapPoint.latitude}`)
      })

      view.popup.defaultPopupTemplateEnabled = true;
    });

  </script>
</head>

<body>
  <div id="viewDiv"></div>
</body>

</html>